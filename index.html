<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>JapaneseGO V6.0</title>
    <style>
        :root {
            --bg-color: #000000;
            --card-bg: #1c1c1e;
            --accent-color: #0A84FF;
            --text-primary: #FFFFFF;
            --text-secondary: #8E8E93;
            --safe-top: env(safe-area-inset-top);
        }

        * {
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            padding-bottom: 120px;
        }

        /* é ‚éƒ¨å›ºå®šå€ */
        .sticky-header-wrapper {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-top: var(--safe-top);
        }

        .app-title {
            padding: 15px 20px 5px 20px;
        }
        h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(90deg, #fff, #aaa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* åˆ†é¡æŒ‰éˆ•å€ */
        .tabs-container {
            width: 100%;
            overflow-x: auto;
            padding: 10px 15px 15px 15px;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
            display: none; /* é è¨­éš±è— */
        }
        .tabs-container::-webkit-scrollbar { display: none; }

        /* æ”¹ç”¨ button æ¨™ç±¤ä»¥ç¢ºä¿ iOS é»æ“Šåæ‡‰ */
        .tab-btn {
            display: inline-block;
            appearance: none;
            background: #333;
            color: #ccc;
            border: 1px solid #444;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 15px;
            font-weight: 600;
            margin-right: 10px;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .tab-btn:active {
            transform: scale(0.95);
            background: #555;
        }

        .tab-btn.active {
            background: var(--accent-color);
            color: #fff;
            border-color: var(--accent-color);
            box-shadow: 0 0 10px rgba(10, 132, 255, 0.4);
        }

        /* å…§å®¹å€ */
        .view {
            display: none;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
            animation: fadeIn 0.3s ease;
        }
        .view.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* é€²åº¦æ¢ */
        .progress-box {
            background: #1c1c1e;
            padding: 20px;
            border-radius: 20px;
            border: 1px solid #333;
            margin-bottom: 25px;
        }

        /* èª²ç¨‹åˆ—è¡¨ */
        .week-block { margin-bottom: 30px; }
        .week-title { 
            color: var(--accent-color); font-weight: 700; font-size: 18px; margin-bottom: 10px; 
            border-left: 4px solid var(--accent-color); padding-left: 10px;
        }

        .lesson-row {
            display: flex; align-items: center;
            background: #222;
            padding: 15px;
            border-radius: 14px;
            margin-bottom: 10px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .lesson-row:active { background: #333; }
        
        .check-box {
            width: 30px; height: 30px; border-radius: 50%; border: 2px solid #555;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s;
            margin-left: auto;
        }
        .check-box.checked { background: #30D158; border-color: #30D158; }

        /* å­—å…¸å¡ç‰‡ */
        .card {
            background: var(--card-bg);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 18px;
            padding: 20px;
            margin-bottom: 15px;
            position: relative;
        }
        .card:active { background: #2a2a2a; transform: scale(0.98); }

        .jp-big { font-size: 22px; font-weight: 800; margin-bottom: 5px; color: #fff; }
        .romaji { font-family: monospace; color: #FFD60A; font-size: 15px; margin-bottom: 10px; display: block; }
        .cn { font-size: 16px; color: #ccc; }
        .speaker { position: absolute; top: 20px; right: 20px; font-size: 20px; opacity: 0.6; }

        /* åº•éƒ¨å°èˆª */
        .bottom-nav {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            height: 85px;
            background: rgba(10,10,10,0.98);
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-around;
            padding-top: 12px;
            padding-bottom: env(safe-area-inset-bottom);
            z-index: 2000;
        }
        .nav-btn {
            text-align: center; color: #666; font-size: 11px; width: 50%;
            transition: color 0.2s;
        }
        .nav-btn.active { color: var(--accent-color); }
        .nav-icon { font-size: 24px; display: block; margin-bottom: 4px; }

    </style>
</head>
<body>

<div class="sticky-header-wrapper">
    <div class="app-title">
        <h1>JapaneseGO</h1>
        <div style="font-size: 12px; color: #888;">æ²–ç¹©ç‰¹è¨“ V6.0 (Fixed)</div>
    </div>
    
    <div id="tabs-bar" class="tabs-container">
        <button class="tab-btn active" onclick="filterDict('all', this)">å…¨éƒ¨</button>
        <button class="tab-btn" onclick="filterDict('survival', this)">ç”Ÿå­˜</button>
        <button class="tab-btn" onclick="filterDict('dining', this)">ç¾é£Ÿ</button>
        <button class="tab-btn" onclick="filterDict('shopping', this)">è³¼ç‰©</button>
        <button class="tab-btn" onclick="filterDict('kids', this)">è¦ªå­</button>
        <button class="tab-btn" onclick="filterDict('driving', this)">è‡ªé§•</button>
        <button class="tab-btn" onclick="filterDict('hotel', this)">ä½å®¿</button>
        <button class="tab-btn" onclick="filterDict('emergency', this)">ç·Šæ€¥</button>
    </div>
</div>

<div id="view-learn" class="view active">
    <div class="progress-box">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px; color:#aaa;">
            <span>ç¸½é€²åº¦</span>
            <span id="progress-text">0%</span>
        </div>
        <div style="height:8px; background:#333; border-radius:4px;">
            <div id="progress-fill" style="height:100%; background:#30D158; width:0%; transition:0.3s;"></div>
        </div>
    </div>
    <div id="curriculum-container"></div>
</div>

<div id="view-dict" class="view">
    <div id="dict-container"></div>
</div>

<div class="bottom-nav">
    <div class="nav-btn active" onclick="switchView('learn', this)">
        <span class="nav-icon">ğŸ“…</span>
        ç‰¹è¨“è¨ˆç•«
    </div>
    <div class="nav-btn" onclick="switchView('dict', this)">
        <span class="nav-icon">ğŸ“–</span>
        å¯¦ç”¨å­—å…¸
    </div>
</div>

<script>
    // --- è³‡æ–™åº« (60+ å¥) ---
    const phrases = [
        { id: "s1", cat: "survival", jp: "ã™ã¿ã¾ã›ã‚“", romaji: "Su-mi-ma-sen", cn: "ä¸å¥½æ„æ€" },
        { id: "s2", cat: "survival", jp: "ã‚ã‚ŠãŒã¨ã†", romaji: "A-ri-ga-tou", cn: "è¬è¬" },
        { id: "s3", cat: "survival", jp: "å¤§ä¸ˆå¤«", romaji: "Dai-jou-bu", cn: "æ²’é—œä¿‚ / ä¸ç”¨äº†" },
        { id: "s4", cat: "survival", jp: "ã¯ã„ / ã„ã„ãˆ", romaji: "Hai / Ii-e", cn: "æ˜¯ / ä¸æ˜¯" },
        { id: "s5", cat: "survival", jp: "ã‚ã‹ã‚Šã¾ã›ã‚“", romaji: "Wa-ka-ri-ma-sen", cn: "è½ä¸æ‡‚" },
        
        { id: "d1", cat: "dining", jp: "ã“ã‚Œãã ã•ã„", romaji: "Ko-re Ku-da-sai", cn: "æˆ‘è¦é€™å€‹" },
        { id: "d2", cat: "dining", jp: "ãŠæ°´", romaji: "O-mi-zu", cn: "æ°´" },
        { id: "d3", cat: "dining", jp: "ãŠä¼šè¨ˆ", romaji: "O-kai-kei", cn: "çµå¸³" },
        { id: "d4", cat: "dining", jp: "ç¾å‘³ã—ã„", romaji: "Oi-shii", cn: "å¥½åƒ" },
        { id: "d5", cat: "dining", jp: "æ°·ãªã—", romaji: "Koo-ri Na-shi", cn: "å»å†°" },
        { id: "d6", cat: "dining", jp: "ãŠã™ã™ã‚ã¯ï¼Ÿ", romaji: "O-su-su-me wa?", cn: "æ¨è–¦ä»€éº¼ï¼Ÿ" },

        { id: "sh1", cat: "shopping", jp: "ã„ãã‚‰ï¼Ÿ", romaji: "I-ku-ra?", cn: "å¤šå°‘éŒ¢ï¼Ÿ" },
        { id: "sh2", cat: "shopping", jp: "ã‚«ãƒ¼ãƒ‰OKï¼Ÿ", romaji: "Kaa-do OK?", cn: "å¯ä»¥åˆ·å¡å—ï¼Ÿ" },
        { id: "sh3", cat: "shopping", jp: "å…ç¨", romaji: "Men-zei", cn: "é€€ç¨…" },
        { id: "sh4", cat: "shopping", jp: "æ–°ã—ã„ã®", romaji: "A-ta-ra-shii no", cn: "æœ‰æ–°çš„å—ï¼Ÿ" },

        { id: "k1", cat: "kids", jp: "å­ä¾›ã®æ¤…å­", romaji: "Ko-do-mo Isu", cn: "å…’ç«¥æ¤…" },
        { id: "k2", cat: "kids", jp: "ã‚¹ãƒ—ãƒ¼ãƒ³", romaji: "Su-puu-n", cn: "æ¹¯åŒ™" },
        { id: "k3", cat: "kids", jp: "ãŠæ¹¯", romaji: "O-yu", cn: "ç†±æ°´" },
        { id: "k4", cat: "kids", jp: "ãƒˆã‚¤ãƒ¬", romaji: "To-i-re", cn: "å»æ‰€" },
        
        { id: "dr1", cat: "driving", jp: "æº€ã‚¿ãƒ³", romaji: "Man-tan", cn: "åŠ æ»¿æ²¹" },
        { id: "dr2", cat: "driving", jp: "ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼", romaji: "Re-gyu-raa", cn: "åŠ æ™®é€šæ²¹" },
        { id: "dr3", cat: "driving", jp: "é§è»Šå ´", romaji: "Chuu-sha-jou", cn: "åœè»Šå ´" },

        { id: "h1", cat: "hotel", jp: "ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³", romaji: "Chek-ku-in", cn: "Check-in" },
        { id: "h2", cat: "hotel", jp: "è·ç‰©", romaji: "Ni-mo-tsu", cn: "è¡Œæ" },

        { id: "e1", cat: "emergency", jp: "åŠ©ã‘ã¦", romaji: "Ta-su-ke-te", cn: "æ•‘å‘½" },
        { id: "e2", cat: "emergency", jp: "è–¬å±€", romaji: "Yak-kyo-ku", cn: "è—¥å±€" },
        { id: "e3", cat: "emergency", jp: "ç—…é™¢", romaji: "Byou-in", cn: "é†«é™¢" }
    ];

    const weeks = [
        { t: "Week 1 æš–èº«", ids: ["s1","s2","s3","s4"] },
        { t: "Week 2 é»é¤", ids: ["d1","d2","d3","d4"] },
        { t: "Week 3 è³¼ç‰©", ids: ["sh1","sh2","sh3"] },
        { t: "Week 4 è¦ªå­", ids: ["k1","k2","k3","k4"] },
        { t: "Week 5 è‡ªé§•", ids: ["dr1","dr2","dr3"] },
        { t: "Week 6 ä½å®¿", ids: ["h1","h2","s5"] },
        { t: "Week 7 ç·Šæ€¥", ids: ["e1","e2","e3"] }
    ];

    // åˆå§‹åŒ–
    renderPlan();
    filterDict('all', null); // ä¿®æ­£ï¼šé€™è£¡å‘¼å«çš„åç¨±çµ‚æ–¼å°äº†

    // åˆ‡æ›é é¢
    function switchView(viewName, btn) {
        document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
        
        document.getElementById('view-' + viewName).classList.add('active');
        btn.classList.add('active');

        // æ§åˆ¶åˆ†é¡æŒ‰éˆ•åˆ—é¡¯ç¤º
        const tabs = document.getElementById('tabs-bar');
        if (viewName === 'dict') {
            tabs.style.display = 'block';
        } else {
            tabs.style.display = 'none';
        }
        
        window.scrollTo(0, 0);
    }

    // æ¸²æŸ“å­—å…¸ (ä¿®æ­£ï¼šå‡½æ•¸åç¨±æ”¹å› filterDictï¼Œå°æ‡‰ HTML onclick)
    function filterDict(cat, btn) {
        if(btn) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }
        
        const container = document.getElementById('dict-container');
        container.innerHTML = '';
        
        const data = (cat === 'all') ? phrases : phrases.filter(p => p.cat === cat);
        
        data.forEach(p => {
            container.innerHTML += `
                <div class="card" onclick="speak('${p.jp}')">
                    <div class="jp-big">${p.jp}</div>
                    <span class="romaji">${p.romaji}</span>
                    <div class="cn">${p.cn}</div>
                    <div class="speaker">ğŸ”Š</div>
                </div>`;
        });
    }

    // æ¸²æŸ“è¨ˆç•«
    function renderPlan() {
        const container = document.getElementById('curriculum-container');
        let saved = JSON.parse(localStorage.getItem('jp_v5_progress') || '[]');
        
        weeks.forEach(w => {
            let html = `<div class="week-block"><div class="week-title">${w.t}</div>`;
            w.ids.forEach(id => {
                let p = phrases.find(x => x.id === id);
                let checked = saved.includes(id) ? 'checked' : '';
                if(p) {
                    html += `
                        <div class="lesson-row">
                            <div style="margin-right:15px; font-size:20px; opacity:0.8;" onclick="speak('${p.jp}')">â–¶</div>
                            <div class="lesson-text" onclick="speak('${p.jp}')">
                                <div style="font-weight:bold; font-size:16px; color:#fff;">${p.jp}</div>
                                <div style="font-size:13px; color:#aaa;">${p.cn}</div>
                            </div>
                            <div class="check-box ${checked}" onclick="toggleCheck('${id}', this)">
                                <span style="color:#fff; font-size:18px;">âœ“</span>
                            </div>
                        </div>`;
                }
            });
            container.innerHTML += html + '</div>';
        });
        updateBar();
    }

    // é€²åº¦æ§åˆ¶
    function toggleCheck(id, el) {
        let saved = JSON.parse(localStorage.getItem('jp_v5_progress') || '[]');
        if (saved.includes(id)) {
            saved = saved.filter(x => x !== id);
            el.classList.remove('checked');
        } else {
            saved.push(id);
            el.classList.add('checked');
        }
        localStorage.setItem('jp_v5_progress', JSON.stringify(saved));
        updateBar();
    }

    function updateBar() {
        let saved = JSON.parse(localStorage.getItem('jp_v5_progress') || '[]');
        let total = weeks.reduce((a, b) => a + b.ids.length, 0);
        let pct = Math.round((saved.length / total) * 100);
        document.getElementById('progress-fill').style.width = pct + '%';
        document.getElementById('progress-text').innerText = pct + '%';
    }

    // ç™¼éŸ³
    function speak(txt) {
        let u = new SpeechSynthesisUtterance(txt);
        u.lang = 'ja-JP';
        window.speechSynthesis.speak(u);
    }
</script>

</body>
</html>
