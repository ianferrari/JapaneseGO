<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JapaneseGO V3.1</title>
    <style>
        :root {
            --bg-color: #000000;
            --card-bg: #1c1c1e;
            --glass-border: rgba(255, 255, 255, 0.15);
            --accent-color: #0A84FF;
            --success-color: #30D158;
            --text-primary: #FFFFFF;
            --text-secondary: #8E8E93;
            --text-romaji: #FFD60A;
            --danger: #FF453A;
            --header-height: 145px; /* å›ºå®šé ‚éƒ¨é«˜åº¦ */
        }

        * {
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
        }

        body {
            background-color: #000000;
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            padding-top: var(--header-height); /* é—œéµï¼šæŠŠå…§å®¹å¾€ä¸‹æ¨ï¼Œä¸è¢«æ¨™é¡Œæ“‹ä½ */
            padding-bottom: 120px;
            -webkit-font-smoothing: antialiased;
        }

        /* --- é ‚éƒ¨å›ºå®šæ§åˆ¶å° (Header + Tabs) --- */
        .fixed-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: rgba(20, 20, 20, 0.98); /* ä¸é€æ˜èƒŒæ™¯ï¼Œé¿å…èª¤è§¸ */
            border-bottom: 1px solid var(--glass-border);
            z-index: 1000; /* æœ€é«˜å±¤ç´šï¼Œä¿è­‰å¯é»æ“Š */
            display: flex;
            flex-direction: column;
            justify-content: flex-end; /* å…§å®¹é ä¸‹å°é½Š */
            padding-bottom: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        .header-title-area {
            position: absolute;
            top: 45px;
            left: 20px;
        }

        h1 {
            margin: 0;
            font-size: 28px;
            background: linear-gradient(90deg, #fff, #aaa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        /* --- åˆ†é¡æŒ‰éˆ•å€ --- */
        .tabs-wrapper {
            width: 100%;
            overflow-x: auto;
            padding: 0 15px;
            -webkit-overflow-scrolling: touch; /* iOS æ»‘å‹•å„ªåŒ– */
            scrollbar-width: none;
            margin-bottom: 5px;
        }
        .tabs-wrapper::-webkit-scrollbar { display: none; }

        .tabs-container {
            display: flex;
            gap: 10px;
            padding-right: 20px; /* å³å´ç•™ç™½ */
        }

        .tab-btn {
            appearance: none;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(60, 60, 60, 0.6);
            color: #ddd;
            padding: 8px 18px;
            border-radius: 20px;
            font-size: 15px;
            font-weight: 600;
            white-space: nowrap;
            cursor: pointer;
            flex-shrink: 0; /* é˜²æ­¢è¢«æ“ å£“ */
            transition: all 0.1s;
        }

        .tab-btn:active {
            transform: scale(0.95);
            background: #555;
        }

        .tab-btn.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        /* --- å…§å®¹å€ --- */
        .view {
            display: none;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        .view.active-view { display: block; }

        /* å¡ç‰‡æ¨£å¼ */
        .card {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 18px;
            padding: 20px;
            margin-bottom: 16px;
            position: relative;
        }
        .card:active { background: #2c2c2e; }
        
        .card-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
        .jp { font-size: 20px; font-weight: 700; line-height: 1.4; color: #fff; }
        .romaji { font-family: 'Courier New', monospace; color: var(--text-romaji); font-size: 14px; font-weight: 600; display: block; margin-bottom: 12px; }
        .cn { font-size: 16px; color: #ddd; font-weight: 500; }
        .en { font-size: 12px; color: #888; margin-top: 4px; }
        .speaker-icon { font-size: 18px; opacity: 0.7; padding: 5px; background: rgba(255,255,255,0.1); border-radius: 50%; }

        /* ç·Šæ€¥å¡ç‰‡ */
        .card.emergency { background: rgba(50, 10, 10, 0.6); border-color: rgba(255, 69, 58, 0.4); }
        .card.emergency .romaji { color: #FF9F0A; }

        /* é€²åº¦æ¢å€å¡Š */
        .progress-box {
            background: #1c1c1e;
            padding: 20px;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            margin-bottom: 25px;
        }
        .progress-header { display: flex; justify-content: space-between; margin-bottom: 10px; color: #aaa; font-size: 14px; }
        .bar-bg { background: #333; height: 8px; border-radius: 4px; overflow: hidden; }
        .bar-fill { background: var(--success-color); height: 100%; width: 0%; transition: width 0.6s cubic-bezier(0.22, 1, 0.36, 1); }

        /* èª²ç¨‹åˆ—è¡¨ */
        .week-block { margin-bottom: 30px; }
        .week-header { font-size: 18px; font-weight: 700; color: var(--accent-color); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .week-desc { font-size: 12px; color: #666; font-weight: normal; margin-left: auto; }
        
        .lesson-row {
            display: flex; align-items: center;
            background: rgba(44,44,46,0.4);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 14px;
            padding: 12px 16px;
            margin-bottom: 8px;
        }
        .play-mini { font-size: 16px; width: 32px; height: 32px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px; flex-shrink: 0; cursor: pointer; }
        .lesson-text { flex-grow: 1; }
        .l-jp { font-weight: 700; font-size: 15px; margin-bottom: 2px; }
        .l-cn { font-size: 13px; color: #aaa; }
        
        .check-circle {
            width: 28px; height: 28px; border-radius: 50%; border: 2px solid #555;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.2s; margin-left: 10px;
        }
        .check-circle.checked { background: var(--success-color); border-color: var(--success-color); }
        .check-icon { color: white; font-size: 16px; display: none; }
        .check-circle.checked .check-icon { display: block; }

        /* åº•éƒ¨å°èˆª */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(20,20,20,0.98);
            border-top: 1px solid rgba(255,255,255,0.1);
            display: flex; justify-content: space-around;
            padding: 10px 0 30px 0; z-index: 1000;
        }
        .nav-btn {
            display: flex; flex-direction: column; align-items: center;
            color: #666; font-size: 10px; cursor: pointer; transition: color 0.2s; width: 50%;
        }
        .nav-btn.active { color: var(--accent-color); }
        .nav-icon { font-size: 24px; margin-bottom: 4px; }

        /* Toast */
        #toast {
            position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(20px);
            background: rgba(30,30,30,0.95); color: white; padding: 12px 24px;
            border-radius: 30px; font-size: 14px; opacity: 0; pointer-events: none;
            transition: all 0.3s; z-index: 2000; border: 1px solid #444; display: flex; align-items: center; gap: 8px;
        }
        #toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

    </style>
</head>
<body>

<div class="fixed-header" id="main-header">
    <div class="header-title-area">
        <h1>JapaneseGO</h1>
        <div style="font-size: 13px; color: #888;">æ²–ç¹©ç‰¹è¨“ V3.1</div>
    </div>

    <div class="tabs-wrapper" id="sticky-tabs" style="display:none;">
        <div class="tabs-container">
            <button class="tab-btn active" onclick="filterDict('all', this)">å…¨éƒ¨</button>
            <button class="tab-btn" onclick="filterDict('survival', this)">ç”Ÿå­˜</button>
            <button class="tab-btn" onclick="filterDict('dining', this)">ç¾é£Ÿ</button>
            <button class="tab-btn" onclick="filterDict('shopping', this)">è³¼ç‰©</button>
            <button class="tab-btn" onclick="filterDict('kids', this)">è¦ªå­</button>
            <button class="tab-btn" onclick="filterDict('driving', this)">è‡ªé§•</button>
            <button class="tab-btn" onclick="filterDict('hotel', this)">ä½å®¿</button>
            <button class="tab-btn" onclick="filterDict('emergency', this)">ç·Šæ€¥</button>
        </div>
    </div>
</div>

<div id="view-learn" class="view active-view">
    <div class="progress-box">
        <div class="progress-header">
            <span>ğŸš€ å­¸ç¿’é€²åº¦</span>
            <span id="progress-text">0%</span>
        </div>
        <div class="bar-bg">
            <div class="bar-fill" id="progress-fill"></div>
        </div>
        <div style="margin-top:10px; font-size:12px; color:#666;">ç›®æ¨™ï¼šæ˜å¹´3æœˆç„¡éšœç¤™æ—…éŠï¼</div>
    </div>
    <div id="curriculum-container"></div>
</div>

<div id="view-dict" class="view">
    <div id="dict-container"></div>
</div>

<div id="toast">ğŸ”Š ç™¼éŸ³æ’­æ”¾ä¸­...</div>

<div class="bottom-nav">
    <div class="nav-btn active" onclick="switchMainView('learn', this)">
        <div class="nav-icon">ğŸ“…</div>
        <div>ç‰¹è¨“è¨ˆç•«</div>
    </div>
    <div class="nav-btn" onclick="switchMainView('dict', this)">
        <div class="nav-icon">ğŸ“–</div>
        <div>å¯¦ç”¨å­—å…¸</div>
    </div>
</div>

<script>
    // --- æ“´å……è³‡æ–™åº« (ä¿æŒ V3.0 çš„è±å¯Œå…§å®¹) ---
    const phrases = [
        // 1. SURVIVAL
        { id: "s1", category: "survival", jp: "ã™ã¿ã¾ã›ã‚“", romaji: "Su-mi-ma-sen", cn: "ä¸å¥½æ„æ€ / è«‹å•", en: "Excuse me" },
        { id: "s2", category: "survival", jp: "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™", romaji: "A-ri-ga-tou Go-zai-ma-su", cn: "è¬è¬", en: "Thank you" },
        { id: "s3", category: "survival", jp: "å¤§ä¸ˆå¤«ã§ã™", romaji: "Dai-jou-bu de-su", cn: "æ²’é—œä¿‚ / ä¸ç”¨äº†", en: "No thanks / I'm OK" },
        { id: "s4", category: "survival", jp: "ã¯ã„ / ã„ã„ãˆ", romaji: "Hai / Ii-e", cn: "æ˜¯ / ä¸æ˜¯", en: "Yes / No" },
        { id: "s5", category: "survival", jp: "ã‚ã‹ã‚Šã¾ã›ã‚“", romaji: "Wa-ka-ri-ma-sen", cn: "æˆ‘è½ä¸æ‡‚", en: "I don't understand" },
        { id: "s6", category: "survival", jp: "ã‚‚ã†ä¸€åº¦ãŠé¡˜ã„ã—ã¾ã™", romaji: "Mou i-chi-do o-ne-gai...", cn: "è«‹å†èªªä¸€æ¬¡", en: "One more time please" },
        { id: "s7", category: "survival", jp: "ä¸­å›½èªãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯ï¼Ÿ", romaji: "Chuu-go-ku-go me-nyuu wa?", cn: "æœ‰ä¸­æ–‡èœå–®å—ï¼Ÿ", en: "Chinese menu?" },

        // 2. DINING
        { id: "d1", category: "dining", jp: "ã“ã‚Œã€ãŠé¡˜ã„ã—ã¾ã™", romaji: "Ko-re, o-ne-gai...", cn: "æˆ‘è¦é»é€™å€‹", en: "This one please" },
        { id: "d2", category: "dining", jp: "ãŠæ°´ãã ã•ã„", romaji: "O-mi-zu ku-da-sai", cn: "è«‹çµ¦æˆ‘æ°´", en: "Water please" },
        { id: "d3", category: "dining", jp: "ãŠä¼šè¨ˆãŠé¡˜ã„ã—ã¾ã™", romaji: "O-kai-kei o-ne-gai...", cn: "éº»ç…©çµå¸³", en: "Check please" },
        { id: "d4", category: "dining", jp: "ãŠã™ã™ã‚ã¯ä½•ã§ã™ã‹ï¼Ÿ", romaji: "O-su-su-me wa nan de-su ka?", cn: "æœ‰ä»€éº¼æ¨è–¦çš„å—ï¼Ÿ", en: "What do you recommend?" },
        { id: "d5", category: "dining", jp: "ã‚ã•ã³æŠœãã§", romaji: "Wa-sa-bi nu-ki de", cn: "ä¸è¦åŠ å“‡æ²™ç±³", en: "No wasabi" },
        { id: "d6", category: "dining", jp: "æ°·ãªã—ã§", romaji: "Koo-ri na-shi de", cn: "å»å†°", en: "No ice" },
        { id: "d7", category: "dining", jp: "ç¾å‘³ã—ã„ï¼", romaji: "Oi-shii!", cn: "å¥½åƒï¼", en: "Delicious!" },
        { id: "d8", category: "dining", jp: "è±šè‚‰ã¯å…¥ã£ã¦ã¾ã™ã‹ï¼Ÿ", romaji: "Bu-ta-ni-ku wa hait-te...", cn: "æœ‰å«è±¬è‚‰å—ï¼Ÿ", en: "Contains pork?" },
        
        // 3. SHOPPING
        { id: "sh1", category: "shopping", jp: "ã“ã‚Œã‚’è¦‹ã›ã¦ãã ã•ã„", romaji: "Ko-re o mi-se-te...", cn: "è«‹è®“æˆ‘çœ‹é€™å€‹", en: "Show me this" },
        { id: "sh2", category: "shopping", jp: "ã„ãã‚‰ã§ã™ã‹ï¼Ÿ", romaji: "I-ku-ra de-su ka?", cn: "å¤šå°‘éŒ¢ï¼Ÿ", en: "How much?" },
        { id: "sh3", category: "shopping", jp: "ã‚«ãƒ¼ãƒ‰ä½¿ãˆã¾ã™ã‹ï¼Ÿ", romaji: "Kaa-do tsu-ka-e-ma-su ka?", cn: "å¯ä»¥åˆ·å¡å—ï¼Ÿ", en: "Card OK?" },
        { id: "sh4", category: "shopping", jp: "å…ç¨ã§ãã¾ã™ã‹ï¼Ÿ", romaji: "Men-zei de-ki-ma-su ka?", cn: "å¯ä»¥é€€ç¨…å—ï¼Ÿ", en: "Tax free?" },
        { id: "sh5", category: "shopping", jp: "è©¦ç€ã§ãã¾ã™ã‹ï¼Ÿ", romaji: "Shi-cha-ku de-ki-ma-su ka?", cn: "å¯ä»¥è©¦ç©¿å—ï¼Ÿ", en: "Can I try on?" },
        { id: "sh6", category: "shopping", jp: "æ–°ã—ã„ã®ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ", romaji: "A-ta-ra-shii no wa...", cn: "æœ‰æ–°çš„å—ï¼Ÿ", en: "New one?" },
        { id: "sh7", category: "shopping", jp: "åˆ¥ã€…ã«ã§ãã¾ã™ã‹ï¼Ÿ", romaji: "Be-tsu-be-tsu ni de-ki-ma-su ka?", cn: "å¯ä»¥åˆ†é–‹è£/çµå¸³å—ï¼Ÿ", en: "Separate please" },

        // 4. KIDS
        { id: "k1", category: "kids", jp: "å­ä¾›ç”¨ã®æ¤…å­", romaji: "Ko-do-mo you no i-su", cn: "å…’ç«¥æ¤…", en: "High chair" },
        { id: "k2", category: "kids", jp: "ã‚¹ãƒ—ãƒ¼ãƒ³ã¨ãƒ•ã‚©ãƒ¼ã‚¯", romaji: "Su-puu-n to foo-ku", cn: "æ¹¯åŒ™å’Œå‰å­", en: "Spoon and fork" },
        { id: "k3", category: "kids", jp: "ãƒˆã‚¤ãƒ¬ã©ã“ã§ã™ã‹ï¼Ÿ", romaji: "To-i-re do-ko de-su ka?", cn: "å»æ‰€åœ¨å“ªï¼Ÿ", en: "Where is toilet?" },
        { id: "k4", category: "kids", jp: "ãŠæ¹¯ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ", romaji: "O-yu mo-ra-e-ma-su ka?", cn: "å¯ä»¥çµ¦æˆ‘ç†±æ°´å—ï¼Ÿ(æ³¡å¥¶)", en: "Hot water?" },
        { id: "k5", category: "kids", jp: "æˆä¹³å®¤ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ", romaji: "Ju-nyuu-shi-tsu wa...", cn: "æœ‰å“ºä¹³å®¤å—ï¼Ÿ", en: "Nursing room?" },
        { id: "k6", category: "kids", jp: "å­ä¾›ãŒçœ ã„ã§ã™", romaji: "Ko-do-mo ga ne-mui de-su", cn: "å°å­©æƒ³ç¡è¦ºäº†", en: "Child is sleepy" },
        { id: "k7", category: "kids", jp: "è¾›ããªã„ã§ã™ã‹ï¼Ÿ", romaji: "Ka-ra-ku nai de-su ka?", cn: "æœƒè¾£å—ï¼Ÿ", en: "Is it spicy?" },

        // 5. DRIVING
        { id: "dr1", category: "driving", jp: "æº€ã‚¿ãƒ³ã€ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ã§", romaji: "Man-tan, Re-gyu-raa de", cn: "åŠ æ»¿ï¼Œæ™®é€šæ±½æ²¹", en: "Full tank Regular" },
        { id: "dr2", category: "driving", jp: "é§è»Šå ´ã©ã“ã§ã™ã‹ï¼Ÿ", romaji: "Chuu-sha-jou do-ko...", cn: "åœè»Šå ´åœ¨å“ªï¼Ÿ", en: "Where is parking?" },
        { id: "dr3", category: "driving", jp: "ç¾é‡‘ã®ã¿ã§ã™ã‹ï¼Ÿ", romaji: "Gen-kin no-mi de-su ka?", cn: "åªæ”¶ç¾é‡‘å—ï¼Ÿ", en: "Cash only?" },
        { id: "dr4", category: "driving", jp: "é ˜åæ›¸ãã ã•ã„", romaji: "Ryou-shuu-sho ku-da-sai", cn: "è«‹çµ¦æˆ‘æ”¶æ“š", en: "Receipt please" },

        // 6. HOTEL
        { id: "h1", category: "hotel", jp: "ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ãŠé¡˜ã„ã—ã¾ã™", romaji: "Chek-ku-in o-ne-gai...", cn: "æˆ‘è¦è¾¦ç†å…¥ä½", en: "Check-in please" },
        { id: "h2", category: "hotel", jp: "è·ç‰©é ã‹ã£ã¦ãã‚Œã¾ã™ã‹ï¼Ÿ", romaji: "Ni-mo-tsu a-zu-kat-te...", cn: "å¯ä»¥å¯„æ”¾è¡Œæå—ï¼Ÿ", en: "Keep bags?" },
        { id: "h3", category: "hotel", jp: "Wi-Fiãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ï¼Ÿ", romaji: "Wi-Fi pa-su-waa-do wa?", cn: "Wi-Fi å¯†ç¢¼æ˜¯ï¼Ÿ", en: "Wi-Fi password?" },
        { id: "h4", category: "hotel", jp: "ã‚¿ã‚¯ã‚·ãƒ¼å‘¼ã‚“ã§ãã ã•ã„", romaji: "Ta-ku-shii yon-de...", cn: "è«‹å¹«æˆ‘å«è¨ˆç¨‹è»Š", en: "Call taxi" },

        // 7. EMERGENCY
        { id: "e1", category: "emergency", jp: "åŠ©ã‘ã¦ï¼", romaji: "Ta-su-ke-te!", cn: "æ•‘å‘½ï¼", en: "Help!" },
        { id: "e2", category: "emergency", jp: "ãƒ‘ã‚¹ãƒãƒ¼ãƒˆãªãã—ã¾ã—ãŸ", romaji: "Pa-su-poo-to na-ku-shi-ma-shi-ta", cn: "è­·ç…§ä¸è¦‹äº†", en: "Lost passport" },
        { id: "e3", category: "emergency", jp: "æ•‘æ€¥è»Šå‘¼ã‚“ã§ãã ã•ã„", romaji: "Kyuu-kyuu-sha yon-de...", cn: "è«‹å«æ•‘è­·è»Š", en: "Call ambulance" },
        { id: "e4", category: "emergency", jp: "å­ä¾›ãŒç†±ã‚ã‚Šã¾ã™", romaji: "Ko-do-mo ga ne-tsu a-ri-ma-su", cn: "å°å­©ç™¼ç‡’äº†", en: "Child has fever" },
        { id: "e5", category: "emergency", jp: "è­¦å¯Ÿ", romaji: "Kei-sa-tsu", cn: "è­¦å¯Ÿ", en: "Police" }
    ];

    // --- èª²ç¨‹è¦åŠƒ ---
    const curriculum = [
        { week: 1, title: "ç”Ÿå­˜èµ·æ‰‹å¼", desc: "é€™å¹¾å¥ä¸æœƒä¸èƒ½å‡ºåœ‹", lessons: ["s1", "s2", "s3", "s4"] },
        { week: 2, title: "æºé€šè¬ç”¨å¥", desc: "è½ä¸æ‡‚èˆ‡å†èªªä¸€æ¬¡", lessons: ["s5", "s6", "s7"] },
        { week: 3, title: "é»é¤åŸºç¤ç¯‡", desc: "æˆ‘è¦é€™å€‹ã€é‚£å€‹", lessons: ["d1", "d7", "d3"] },
        { week: 4, title: "é»é¤é€²éšç¯‡", desc: "æ¨è–¦èˆ‡å®¢è£½åŒ–", lessons: ["d4", "d5", "d6"] },
        { week: 5, title: "è³¼ç‰©æ®ºåƒ¹ç¯‡", desc: "å¤šå°‘éŒ¢èˆ‡é€€ç¨…", lessons: ["sh1", "sh2", "sh4"] },
        { week: 6, title: "è³¼ç‰©å¯¦æˆ°ç¯‡", desc: "è©¦ç©¿èˆ‡æ‰¾æ–°å“", lessons: ["sh3", "sh5", "sh6"] },
        { week: 7, title: "è¦ªå­é¤å»³(ä¸Š)", desc: "é¤å…·èˆ‡æ¤…å­", lessons: ["k1", "k2", "d2"] },
        { week: 8, title: "è¦ªå­é¤å»³(ä¸‹)", desc: "ä¸è¾£èˆ‡éæ•è©¢å•", lessons: ["k7", "d8"] },
        { week: 9, title: "çˆ¸åª½æ•‘æ˜Ÿç¯‡", desc: "ç†±æ°´ã€å»æ‰€ã€å“ºä¹³å®¤", lessons: ["k4", "k3", "k5"] },
        { week: 10, title: "å°å­©é¬§æƒ…ç·’", desc: "æƒ³ç¡è¦ºèˆ‡å®‰æ’«", lessons: ["k6", "s3"] },
        { week: 11, title: "è‡ªé§•åŠ æ²¹ç¯‡", desc: "åŠ æ»¿èˆ‡æ™®é€šæ²¹", lessons: ["dr1", "dr3", "dr4"] },
        { week: 12, title: "æ‰¾è·¯åœè»Šç¯‡", desc: "å°èˆªèˆ‡åœè»Šå ´", lessons: ["dr2", "s1"] },
        { week: 13, title: "é£¯åº—ä½å®¿ç¯‡", desc: "å…¥ä½èˆ‡ç¶²è·¯", lessons: ["h1", "h3"] },
        { week: 14, title: "é£¯åº—æœå‹™ç¯‡", desc: "å¯„è¡Œæèˆ‡å«è»Š", lessons: ["h2", "h4"] },
        { week: 15, title: "ç·Šæ€¥ç‹€æ³(ä¸Š)", desc: "ç™¼ç‡’èˆ‡æ±‚æ•‘", lessons: ["e1", "e4", "e5"] },
        { week: 16, title: "ç·Šæ€¥ç‹€æ³(ä¸‹)", desc: "è­·ç…§èˆ‡æ•‘è­·è»Š", lessons: ["e2", "e3"] }
    ];

    // --- ç¨‹å¼é‚è¼¯ ---
    document.addEventListener('DOMContentLoaded', () => {
        renderCurriculum();
        renderDict('all');
        updateProgress();
    });

    function switchMainView(viewId, btn) {
        document.getElementById('view-learn').style.display = 'none';
        document.getElementById('view-dict').style.display = 'none';
        
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        if (viewId === 'learn') {
            document.getElementById('view-learn').style.display = 'block';
            document.getElementById('sticky-tabs').style.display = 'none'; // éš±è—æŒ‰éˆ•
        } else {
            document.getElementById('view-dict').style.display = 'block';
            document.getElementById('sticky-tabs').style.display = 'block'; // é¡¯ç¤ºæŒ‰éˆ•
        }
    }

    function renderDict(filter, btn = null) {
        if(btn) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        const container = document.getElementById('dict-container');
        container.innerHTML = '';
        const data = filter === 'all' ? phrases : phrases.filter(p => p.category === filter);

        data.forEach(p => {
            const card = document.createElement('div');
            card.className = `card ${p.category === 'emergency' ? 'emergency' : ''}`;
            card.onclick = () => speak(p.jp);
            card.innerHTML = `
                <div class="card-top">
                    <div class="jp">${p.jp}</div>
                    <div class="speaker-icon">ğŸ”Š</div>
                </div>
                <span class="romaji">${p.romaji}</span>
                <div class="cn">${p.cn}</div>
                <div class="en">${p.en}</div>
            `;
            container.appendChild(card);
        });
    }

    function renderCurriculum() {
        const container = document.getElementById('curriculum-container');
        const progress = JSON.parse(localStorage.getItem('jp_progress') || '[]');

        curriculum.forEach(week => {
            const block = document.createElement('div');
            block.className = 'week-block';
            let lessonsHtml = '';

            week.lessons.forEach(lid => {
                const p = phrases.find(item => item.id === lid);
                if(p) {
                    const isChecked = progress.includes(lid) ? 'checked' : '';
                    lessonsHtml += `
                        <div class="lesson-row">
                            <div class="play-mini" onclick="speak('${p.jp}')">â–¶</div>
                            <div class="lesson-text" onclick="speak('${p.jp}')">
                                <div class="l-jp">${p.jp}</div>
                                <div class="l-cn">${p.cn}</div>
                            </div>
                            <div class="check-circle ${isChecked}" onclick="toggleCheck('${lid}', this)">
                                <span class="check-icon">âœ”</span>
                            </div>
                        </div>
                    `;
                }
            });

            block.innerHTML = `
                <div class="week-header">
                    <span>Week ${week.week}</span>
                    <span style="font-size:14px; font-weight:normal;">${week.title}</span>
                    <span class="week-desc">${week.desc}</span>
                </div>
                ${lessonsHtml}
            `;
            container.appendChild(block);
        });
    }

    function toggleCheck(id, el) {
        let progress = JSON.parse(localStorage.getItem('jp_progress') || '[]');
        if(progress.includes(id)) {
            progress = progress.filter(i => i !== id);
            el.classList.remove('checked');
        } else {
            progress.push(id);
            el.classList.add('checked');
        }
        localStorage.setItem('jp_progress', JSON.stringify(progress));
        updateProgress();
    }

    function updateProgress() {
        const progress = JSON.parse(localStorage.getItem('jp_progress') || '[]');
        const total = curriculum.reduce((acc, c) => acc + c.lessons.length, 0);
        const percent = Math.round((progress.length / total) * 100);
        document.getElementById('progress-text').innerText = percent + "%";
        document.getElementById('progress-fill').style.width = percent + "%";
    }

    function speak(text) {
        if ('speechSynthesis' in window) {
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(text);
            u.lang = 'ja-JP';
            u.rate = 0.85;
            window.speechSynthesis.speak(u);
            
            const t = document.getElementById('toast');
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 1500);
        }
    }
</script>

</body>
</html>
