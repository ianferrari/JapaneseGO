<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>JapaneseGO V7.0</title>
    <style>
        :root {
            --bg-color: #000000;
            --card-bg: #1c1c1e;
            --accent-color: #0A84FF;
            --user-msg-bg: #0A84FF;
            --staff-msg-bg: #2c2c2e;
            --text-primary: #FFFFFF;
            --text-secondary: #8E8E93;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0; padding: 0;
            padding-bottom: calc(90px + var(--safe-bottom));
        }

        /* é ‚éƒ¨å›ºå®šå€ */
        .sticky-header-wrapper {
            position: sticky; top: 0; z-index: 1000;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-top: var(--safe-top);
        }
        .app-title { padding: 15px 20px 5px 20px; }
        h1 { margin: 0; font-size: 26px; font-weight: 800; background: linear-gradient(90deg, #fff, #aaa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        /* åˆ†é¡æŒ‰éˆ• (åƒ…å­—å…¸ç”¨) */
        .tabs-container {
            width: 100%; overflow-x: auto; padding: 10px 15px 15px 15px;
            white-space: nowrap; -webkit-overflow-scrolling: touch; display: none;
        }
        .tabs-container::-webkit-scrollbar { display: none; }
        .tab-btn {
            display: inline-block; appearance: none; background: #333; color: #ccc;
            border: 1px solid #444; padding: 8px 16px; border-radius: 20px;
            font-size: 14px; font-weight: 600; margin-right: 8px; transition: all 0.2s;
        }
        .tab-btn.active { background: var(--accent-color); color: #fff; border-color: var(--accent-color); }

        /* å…§å®¹å€ */
        .view { display: none; padding: 20px; max-width: 600px; margin: 0 auto; animation: fadeIn 0.3s ease; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- 1. ç‰¹è¨“ & å­—å…¸å…±ç”¨æ¨£å¼ --- */
        .progress-box { background: #1c1c1e; padding: 20px; border-radius: 16px; border: 1px solid #333; margin-bottom: 25px; }
        .week-block { margin-bottom: 30px; }
        .week-title { color: var(--accent-color); font-weight: 700; font-size: 18px; margin-bottom: 10px; padding-left: 10px; border-left: 4px solid var(--accent-color); }
        .lesson-row { display: flex; align-items: center; background: #222; padding: 15px; border-radius: 14px; margin-bottom: 10px; border: 1px solid #333; }
        .check-box { width: 28px; height: 28px; border-radius: 50%; border: 2px solid #555; margin-left: auto; display: flex; align-items: center; justify-content: center; }
        .check-box.checked { background: #30D158; border-color: #30D158; }
        .card { background: #1c1c1e; border: 1px solid #333; border-radius: 16px; padding: 18px; margin-bottom: 12px; position: relative; }
        .jp-big { font-size: 20px; font-weight: 700; margin-bottom: 4px; color: #fff; }
        .romaji { font-family: monospace; color: #FFD60A; font-size: 13px; margin-bottom: 8px; display: block; }
        .cn { font-size: 15px; color: #ccc; }

        /* --- 2. æœƒè©±æ¨¡å¼å°ˆç”¨æ¨£å¼ --- */
        .dialogue-card {
            background: #151515; border: 1px solid #333; border-radius: 16px; 
            margin-bottom: 25px; overflow: hidden;
        }
        .dialogue-header {
            background: #222; padding: 12px 15px; border-bottom: 1px solid #333;
            font-weight: 700; display: flex; align-items: center; gap: 8px; color: #fff;
        }
        .dialogue-body { padding: 15px; display: flex; flex-direction: column; gap: 15px; }
        
        /* æ°£æ³¡æ¨£å¼ */
        .bubble {
            max-width: 85%; padding: 10px 14px; border-radius: 18px; 
            font-size: 15px; line-height: 1.4; position: relative;
            cursor: pointer;
        }
        .bubble:active { opacity: 0.7; }
        
        /* å°æ–¹ (å·¦) */
        .bubble.staff {
            align-self: flex-start; background: var(--staff-msg-bg); 
            border-bottom-left-radius: 4px; color: #ddd;
        }
        .bubble.staff::before { content: "åº—å“¡"; position: absolute; top: -18px; left: 5px; font-size: 10px; color: #666; }
        
        /* æˆ‘ (å³) */
        .bubble.user {
            align-self: flex-end; background: var(--user-msg-bg); 
            border-bottom-right-radius: 4px; color: #fff;
        }
        .bubble.user::before { content: "æˆ‘"; position: absolute; top: -18px; right: 5px; font-size: 10px; color: #666; }

        .bubble-jp { font-weight: 600; margin-bottom: 2px; }
        .bubble-cn { font-size: 12px; opacity: 0.8; }

        /* --- åº•éƒ¨å°èˆª --- */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0; height: 85px;
            background: rgba(15,15,15,0.98); border-top: 1px solid #333;
            display: flex; justify-content: space-around; padding-top: 10px;
            padding-bottom: var(--safe-bottom); z-index: 2000;
        }
        .nav-btn { text-align: center; color: #666; font-size: 10px; width: 33%; transition: color 0.2s; }
        .nav-btn.active { color: var(--accent-color); }
        .nav-icon { font-size: 24px; display: block; margin-bottom: 4px; }
    </style>
</head>
<body>

<div class="sticky-header-wrapper">
    <div class="app-title">
        <h1>JapaneseGO</h1>
        <div style="font-size: 12px; color: #888;">æ²–ç¹©ç‰¹è¨“ V7.0 (æœƒè©±ç‰ˆ)</div>
    </div>
    
    <div id="tabs-bar" class="tabs-container">
        <button class="tab-btn active" onclick="filterDict('all', this)">å…¨éƒ¨</button>
        <button class="tab-btn" onclick="filterDict('survival', this)">ç”Ÿå­˜</button>
        <button class="tab-btn" onclick="filterDict('dining', this)">ç¾é£Ÿ</button>
        <button class="tab-btn" onclick="filterDict('shopping', this)">è³¼ç‰©</button>
        <button class="tab-btn" onclick="filterDict('kids', this)">è¦ªå­</button>
        <button class="tab-btn" onclick="filterDict('driving', this)">è‡ªé§•</button>
        <button class="tab-btn" onclick="filterDict('hotel', this)">ä½å®¿</button>
        <button class="tab-btn" onclick="filterDict('emergency', this)">ç·Šæ€¥</button>
    </div>
</div>

<div id="view-learn" class="view active">
    <div class="progress-box">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px; color:#aaa;">
            <span>å–®å­—é€²åº¦</span>
            <span id="progress-text">0%</span>
        </div>
        <div style="height:8px; background:#333; border-radius:4px;">
            <div id="progress-fill" style="height:100%; background:#30D158; width:0%; transition:0.3s;"></div>
        </div>
    </div>
    <div id="curriculum-container"></div>
</div>

<div id="view-dialogue" class="view">
    <div style="margin-bottom:15px; color:#888; font-size:13px; text-align:center;">
        é»æ“Šå°è©±æ³¡æ³¡å¯è½ç™¼éŸ³ ğŸ”Š
    </div>
    <div id="dialogue-container"></div>
</div>

<div id="view-dict" class="view">
    <div id="dict-container"></div>
</div>

<div class="bottom-nav">
    <div class="nav-btn active" onclick="switchView('learn', this)">
        <span class="nav-icon">ğŸ“…</span>ç‰¹è¨“
    </div>
    <div class="nav-btn" onclick="switchView('dialogue', this)">
        <span class="nav-icon">ğŸ—£ï¸</span>æœƒè©±
    </div>
    <div class="nav-btn" onclick="switchView('dict', this)">
        <span class="nav-icon">ğŸ“–</span>å­—å…¸
    </div>
</div>

<script>
    // --- è³‡æ–™ 1: å–®å­—åº« ---
    const phrases = [
        { id: "s1", cat: "survival", jp: "ã™ã¿ã¾ã›ã‚“", romaji: "Su-mi-ma-sen", cn: "ä¸å¥½æ„æ€" },
        { id: "s2", cat: "survival", jp: "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™", romaji: "A-ri-ga-tou", cn: "è¬è¬" },
        { id: "s3", cat: "survival", jp: "å¤§ä¸ˆå¤«ã§ã™", romaji: "Dai-jou-bu", cn: "æ²’é—œä¿‚/ä¸ç”¨" },
        { id: "d1", cat: "dining", jp: "ã“ã‚Œãã ã•ã„", romaji: "Ko-re Ku-da-sai", cn: "æˆ‘è¦é€™å€‹" },
        { id: "d2", cat: "dining", jp: "ãŠæ°´ãã ã•ã„", romaji: "O-mi-zu", cn: "è«‹çµ¦æˆ‘æ°´" },
        { id: "d3", cat: "dining", jp: "ãŠä¼šè¨ˆãŠé¡˜ã„ã—ã¾ã™", romaji: "O-kai-kei", cn: "éº»ç…©çµå¸³" },
        { id: "sh1", cat: "shopping", jp: "ã„ãã‚‰ã§ã™ã‹ï¼Ÿ", romaji: "I-ku-ra?", cn: "å¤šå°‘éŒ¢ï¼Ÿ" },
        { id: "sh2", cat: "shopping", jp: "ã‚«ãƒ¼ãƒ‰ã¯ä½¿ãˆã¾ã™ã‹ï¼Ÿ", romaji: "Kaa-do OK?", cn: "å¯ä»¥åˆ·å¡å—ï¼Ÿ" },
        { id: "sh3", cat: "shopping", jp: "å…ç¨ã§ãã¾ã™ã‹ï¼Ÿ", romaji: "Men-zei", cn: "å¯ä»¥é€€ç¨…å—ï¼Ÿ" },
        { id: "k1", cat: "kids", jp: "å­ä¾›ç”¨ã®æ¤…å­", romaji: "Ko-do-mo Isu", cn: "å…’ç«¥æ¤…" },
        { id: "k2", cat: "kids", jp: "ã‚¹ãƒ—ãƒ¼ãƒ³", romaji: "Su-puu-n", cn: "æ¹¯åŒ™" },
        { id: "k3", cat: "kids", jp: "ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ï¼Ÿ", romaji: "To-i-re", cn: "å»æ‰€åœ¨å“ª" },
        { id: "dr1", cat: "driving", jp: "æº€ã‚¿ãƒ³", romaji: "Man-tan", cn: "åŠ æ»¿æ²¹" },
        { id: "dr2", cat: "driving", jp: "ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼", romaji: "Re-gyu-raa", cn: "æ™®é€šæ±½æ²¹" },
        { id: "h1", cat: "hotel", jp: "ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ãŠé¡˜ã„ã—ã¾ã™", romaji: "Chek-ku-in", cn: "æˆ‘è¦Check-in" },
        { id: "h2", cat: "hotel", jp: "è·ç‰©ã‚’é ã‹ã£ã¦ãã ã•ã„", romaji: "Ni-mo-tsu", cn: "å¯„æ”¾è¡Œæ" }
    ];

    const weeks = [
        { t: "Week 1 åŸºç¤", ids: ["s1","s2","s3"] },
        { t: "Week 2 é»é¤", ids: ["d1","d2","d3"] },
        { t: "Week 3 è³¼ç‰©", ids: ["sh1","sh2","sh3"] },
        { t: "Week 4 è¦ªå­", ids: ["k1","k2","k3"] },
        { t: "Week 5 æ—…éŠ", ids: ["dr1","h1","h2"] }
    ];

    // --- è³‡æ–™ 2: æƒ…å¢ƒå°è©± (æ–°åŠŸèƒ½) ---
    const dialogues = [
        {
            title: "ğŸ¨ é£¯åº— Check-in",
            msgs: [
                { role: "user", jp: "ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ãŠé¡˜ã„ã—ã¾ã™ã€‚", cn: "ä½ å¥½ï¼Œæˆ‘è¦è¾¦ç†å…¥ä½ã€‚" },
                { role: "staff", jp: "ã¯ã„ã€ãƒ‘ã‚¹ãƒãƒ¼ãƒˆã‚’è¦‹ã›ã¦ãã ã•ã„ã€‚", cn: "å¥½çš„ï¼Œè«‹å‡ºç¤ºè­·ç…§ã€‚" },
                { role: "user", jp: "ã¯ã„ã€ã“ã‚Œã§ã™ã€‚", cn: "å¥½çš„ï¼Œåœ¨é€™è£¡ã€‚" },
                { role: "staff", jp: "æœé£Ÿã¯7æ™‚ã‹ã‚‰ã§ã™ã€‚", cn: "æ—©é¤æ˜¯7é»é–‹å§‹å–”ã€‚" }
            ]
        },
        {
            title: "ğŸœ é¤å»³é»é¤",
            msgs: [
                { role: "staff", jp: "ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›ã€‚ä½•åæ§˜ã§ã™ã‹ï¼Ÿ", cn: "æ­¡è¿å…‰è‡¨ï¼Œè«‹å•å¹¾ä½ï¼Ÿ" },
                { role: "user", jp: "3äººã§ã™ã€‚å­ä¾›ãŒã„ã¾ã™ã€‚", cn: "3ä½ï¼Œæœ‰å°å­©ã€‚" },
                { role: "staff", jp: "ã“ã¡ã‚‰ã¸ã©ã†ãã€‚", cn: "è«‹å¾€é€™é‚Šèµ°ã€‚" },
                { role: "user", jp: "ã“ã‚Œã¨ã“ã‚Œã‚’ãã ã•ã„ã€‚", cn: "æˆ‘è¦é€™å€‹è·Ÿé€™å€‹ã€‚" },
                { role: "user", jp: "ã‚ã•ã³æŠœãã§ãŠé¡˜ã„ã—ã¾ã™ã€‚", cn: "è«‹ä¸è¦åŠ å“‡æ²™ç±³ã€‚" }
            ]
        },
        {
            title: "ğŸª ä¾¿åˆ©å•†åº—",
            msgs: [
                { role: "staff", jp: "æ¸©ã‚ã¾ã™ã‹ï¼Ÿ", cn: "ä¾¿ç•¶è¦å¾®æ³¢åŠ ç†±å—ï¼Ÿ" },
                { role: "user", jp: "ã¯ã„ã€ãŠé¡˜ã„ã—ã¾ã™ã€‚", cn: "å¥½çš„ï¼Œéº»ç…©ä½ äº†ã€‚" },
                { role: "staff", jp: "è¢‹ã¯ã„ã‚Šã¾ã™ã‹ï¼Ÿ", cn: "éœ€è¦è¢‹å­å—ï¼Ÿ" },
                { role: "user", jp: "å¤§ä¸ˆå¤«ã§ã™ã€‚", cn: "æ²’é—œä¿‚ï¼Œä¸ç”¨äº†ã€‚" }
            ]
        },
        {
            title: "ğŸš— åŠ æ²¹ç«™ç§Ÿè»Š",
            msgs: [
                { role: "staff", jp: "ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›ã€‚", cn: "æ­¡è¿å…‰è‡¨ã€‚" },
                { role: "user", jp: "ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ã€æº€ã‚¿ãƒ³ã§ã€‚", cn: "æ™®é€šæ±½æ²¹ï¼ŒåŠ æ»¿ã€‚" },
                { role: "staff", jp: "ç¾é‡‘ã®ã¿ã§ã™ãŒ...", cn: "æˆ‘å€‘åªæ”¶ç¾é‡‘å–”..." },
                { role: "user", jp: "ã‚ã€ã¯ã„ã€‚å¤§ä¸ˆå¤«ã§ã™ã€‚", cn: "å•Šï¼Œå¥½çš„ï¼Œæ²’å•é¡Œã€‚" }
            ]
        }
    ];

    // åˆå§‹åŒ–
    renderPlan();
    renderDialogues();
    filterDict('all', null);

    // åˆ‡æ›è¦–åœ–
    function switchView(name, btn) {
        document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
        
        document.getElementById('view-' + name).classList.add('active');
        btn.classList.add('active');

        // åƒ…åœ¨å­—å…¸æ¨¡å¼é¡¯ç¤ºä¸Šæ–¹åˆ†é¡æ¢
        const tabs = document.getElementById('tabs-bar');
        tabs.style.display = (name === 'dict') ? 'block' : 'none';
        
        window.scrollTo(0,0);
    }

    // æ¸²æŸ“å­—å…¸
    function filterDict(cat, btn) {
        if(btn) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }
        const box = document.getElementById('dict-container');
        box.innerHTML = '';
        const data = (cat==='all') ? phrases : phrases.filter(p=>p.cat===cat);
        data.forEach(p => {
            box.innerHTML += `
                <div class="card" onclick="speak('${p.jp}')">
                    <div class="jp-big">${p.jp} ğŸ”Š</div>
                    <span class="romaji">${p.romaji}</span>
                    <div class="cn">${p.cn}</div>
                </div>`;
        });
    }

    // æ¸²æŸ“ç‰¹è¨“
    function renderPlan() {
        const box = document.getElementById('curriculum-container');
        let saved = JSON.parse(localStorage.getItem('jp_v7_prog')||'[]');
        
        weeks.forEach(w => {
            let html = `<div class="week-block"><div class="week-title">${w.t}</div>`;
            w.ids.forEach(id => {
                let p = phrases.find(x=>x.id===id);
                if(!p) return;
                let chk = saved.includes(id) ? 'checked' : '';
                html += `
                    <div class="lesson-row">
                        <div style="flex:1" onclick="speak('${p.jp}')">
                            <div style="font-weight:700; color:#fff; font-size:16px;">${p.jp} ğŸ”Š</div>
                            <div style="color:#aaa; font-size:13px;">${p.cn}</div>
                        </div>
                        <div class="check-box ${chk}" onclick="toggle('${id}', this)">âœ“</div>
                    </div>`;
            });
            box.innerHTML += html + '</div>';
        });
        updateBar();
    }

    // æ¸²æŸ“æœƒè©± (NEW)
    function renderDialogues() {
        const box = document.getElementById('dialogue-container');
        dialogues.forEach(d => {
            let bubbles = '';
            d.msgs.forEach(m => {
                bubbles += `
                    <div class="bubble ${m.role}" onclick="speak('${m.jp}')">
                        <div class="bubble-jp">${m.jp} ğŸ”Š</div>
                        <div class="bubble-cn">${m.cn}</div>
                    </div>`;
            });
            
            box.innerHTML += `
                <div class="dialogue-card">
                    <div class="dialogue-header">${d.title}</div>
                    <div class="dialogue-body">${bubbles}</div>
                </div>`;
        });
    }

    // é€²åº¦å„²å­˜
    function toggle(id, el) {
        let saved = JSON.parse(localStorage.getItem('jp_v7_prog')||'[]');
        if(saved.includes(id)) {
            saved = saved.filter(x=>x!==id);
            el.classList.remove('checked');
        } else {
            saved.push(id);
            el.classList.add('checked');
        }
        localStorage.setItem('jp_v7_prog', JSON.stringify(saved));
        updateBar();
    }

    function updateBar() {
        let saved = JSON.parse(localStorage.getItem('jp_v7_prog')||'[]');
        let total = weeks.reduce((a,b)=>a+b.ids.length,0);
        let pct = Math.round(saved.length/total*100);
        document.getElementById('progress-fill').style.width = pct+'%';
        document.getElementById('progress-text').innerText = pct+'%';
    }

    function speak(txt) {
        let u = new SpeechSynthesisUtterance(txt);
        u.lang = 'ja-JP';
        window.speechSynthesis.speak(u);
    }
</script>

</body>
</html>
